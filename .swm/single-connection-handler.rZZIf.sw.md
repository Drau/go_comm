---
id: rZZIf
name: Single connection handler
file_version: 1.0.2
app_version: 0.6.5-2
file_blobs:
  conn_manager.go: 3ac47654c323500dc190ea7359cc5e755f42c9db
---

For each new connection, a connection handler is created and lives as long as the session is open.

It receives all incoming messages and acts accordingly.

The @ sign acts as "special" separator indicating an incoming request, as opposed to a regular text message.

<br/>

CONNECT request

Indicating a new connection is requested by an already existing user on the chat room

handler connects to the incoming host/port

<br/>

<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ conn_manager.go
```go
â¬œ 152    		// command from client
â¬œ 153    		case 2:
â¬œ 154    			switch splitMessage[0] {
ðŸŸ© 155    			case "CONNECT":
ðŸŸ© 156    				ips := strings.Split(splitMessage[1], "|")
ðŸŸ© 157    				for _, ip := range ips {
ðŸŸ© 158    					if len(ip) == 1 {continue}
ðŸŸ© 159    					connectClient(conns, removeSpecialChars(ip), chat, logs, loggedUsersUpdate, false)
ðŸŸ© 160    				}
â¬œ 161    			case "INFO":
â¬œ 162    				data := strings.Split(splitMessage[1], "|")
â¬œ 163    				oldName := remoteUser.name
```

<br/>

INFO request

Remote user sends data about him self. handler will update accordingly

<br/>

<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ conn_manager.go
```go
â¬œ 158    					if len(ip) == 1 {continue}
â¬œ 159    					connectClient(conns, removeSpecialChars(ip), chat, logs, loggedUsersUpdate, false)
â¬œ 160    				}
ðŸŸ© 161    			case "INFO":
ðŸŸ© 162    				data := strings.Split(splitMessage[1], "|")
ðŸŸ© 163    				oldName := remoteUser.name
ðŸŸ© 164    				remoteUser.name = data[0]
ðŸŸ© 165    				remoteUser.port = removeSpecialChars(data[1])
ðŸŸ© 166    				conns[remoteUser.name] = remoteUser
ðŸŸ© 167    				delete(conns, oldName)
ðŸŸ© 168    				loggedUsersUpdate <- true
â¬œ 169    			case "PM":
â¬œ 170    				fmt.Fprintf(chat, "[PM]%s >> %s\n", remoteUser.name, strings.TrimSuffix(splitMessage[1], "\n"))
â¬œ 171    			case "GETCONNS":
```

<br/>

PM request

Indicates a remote user sent a private message. Prints the message in a different format

<br/>

<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ conn_manager.go
```go
â¬œ 166    				conns[remoteUser.name] = remoteUser
â¬œ 167    				delete(conns, oldName)
â¬œ 168    				loggedUsersUpdate <- true
ðŸŸ© 169    			case "PM":
ðŸŸ© 170    				fmt.Fprintf(chat, "[PM]%s >> %s\n", remoteUser.name, strings.TrimSuffix(splitMessage[1], "\n"))
â¬œ 171    			case "GETCONNS":
â¬œ 172    				sendConnectionList(conns, remoteUser, logs)
â¬œ 173    			}
```

<br/>

GETCONNS request

Remote user requests info about existing local connections to connect to them as well if needed

The handler sends back a list of existing sessions, Including host IP and port

<br/>

<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ conn_manager.go
```go
â¬œ 168    				loggedUsersUpdate <- true
â¬œ 169    			case "PM":
â¬œ 170    				fmt.Fprintf(chat, "[PM]%s >> %s\n", remoteUser.name, strings.TrimSuffix(splitMessage[1], "\n"))
ðŸŸ© 171    			case "GETCONNS":
ðŸŸ© 172    				sendConnectionList(conns, remoteUser, logs)
ðŸŸ© 173    			}
â¬œ 174    
â¬œ 175    
â¬œ 176    		}
```

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBZ29fY29tbSUzQSUzQURyYXU=/docs/rZZIf).